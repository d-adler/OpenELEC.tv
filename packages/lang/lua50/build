#!/bin/sh

################################################################################
#      This file is part of OpenELEC - http://www.openelec.tv
#      Copyright (C) 2012-2012 Stephan Raue (stephan@openelec.tv)
#
#  This Program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 2, or (at your option)
#  any later version.
#
#  This Program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with OpenELEC.tv; see the file COPYING.  If not, write to
#  the Free Software Foundation, 51 Franklin Street, Suite 500, Boston, MA 02110, USA.
#  http://www.gnu.org/copyleft/gpl.html
################################################################################

. config/options $1

# build and install target packages
  setup_toolchain target

  make -C $PKG_BUILD \
    CC="$TARGET_CC" \
    MYCFLAGS="$TARGET_CFLAGS -O2" \
    AR="$TARGET_AR rcu" \
    RANLIB="$TARGET_RANLIB" \
    STRIP=$TARGET_STRIP \
    MAKEFLAGS=$MAKEFLAGS

    rm -f $PKG_BUILD/lib/lib*.so*
    $TARGET_CC -o $PKG_BUILD/lib/liblua50.so.5.0    -shared $PKG_BUILD/src/*.o
    $TARGET_CC -o $PKG_BUILD/lib/liblualib50.so.5.0 -shared $PKG_BUILD/src/lib/*.o
    (cd $PKG_BUILD/lib
      ln -s liblua50.so.5.0    liblua50.so.5    
      ln -s liblua50.so.5.0    liblua50.so     
      ln -s liblualib50.so.5.0 liblualib50.so.5 
      ln -s liblualib50.so.5.0 liblualib50.so   
    )
  mkdir -p $SYSROOT_PREFIX/usr/lib
    cp $PKG_BUILD/lib/liblua.a      $SYSROOT_PREFIX/usr/lib/liblua50.a
    cp $PKG_BUILD/lib/liblualib.a   $SYSROOT_PREFIX/usr/lib/liblualib50.a
    cp -d $PKG_BUILD/lib/lib*.so*      $SYSROOT_PREFIX/usr/lib
  mkdir -p $SYSROOT_PREFIX/usr/include/lua50
    cp $PKG_BUILD/include/*.h       $SYSROOT_PREFIX/usr/include/lua50
  mkdir -p $SYSROOT_PREFIX/usr/bin
    cp $PKG_BUILD/bin/lua           $SYSROOT_PREFIX/usr/bin/lua50
    #cp $PKG_BUILD/bin/luac          $SYSROOT_PREFIX/usr/bin/luac50

